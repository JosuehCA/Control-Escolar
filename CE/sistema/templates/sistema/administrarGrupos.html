<h1>Administrar Grupos</h1>

<!-- Formulario para crear un nuevo grupo -->
<form method="POST" action="">
    {% csrf_token %}
    <input type="hidden" name="action" value="create">

    <label for="nombre">Nombre del Grupo:</label>
    <input type="text" id="nombre" name="nombre" required>

    <h2>Seleccionar Alumnos:</h2>
    <ul>
        {% for alumno in alumnos %}
            <li>
                <input type="checkbox" name="alumnos" value="{{ alumno.id }}">
                {{ alumno.username }}
            </li>
        {% endfor %}
    </ul>

    <button type="submit">Crear Grupo</button>
</form>

<!-- Listado de Grupos Existentes -->
<h2>Grupos Existentes</h2>
<ul>
    {% for grupo in grupos %}
        <li id="grupo-{{ grupo.id }}">
            <!-- Mostrar el nombre del grupo y listado de alumnos -->
            <strong class="grupo-nombre">{{ grupo.nombre }}</strong>
            <ul>
                {% for alumno in grupo.alumnos.all %}
                    <li>{{ alumno.username }}</li>
                {% endfor %}
            </ul>

            <!-- Botón para editar -->
            <button type="button" onclick="mostrarEdicion({{ grupo.id }})">Editar Grupo</button>

            <!-- Campos de edición ocultos por defecto -->
            <form method="POST" action="" id="form-editar-{{ grupo.id }}" style="display: none;">
                {% csrf_token %}
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="grupo_id" value="{{ grupo.id }}">

                <label for="nombre_{{ grupo.id }}">Nombre del Grupo:</label>
                <input type="text" id="nombre_{{ grupo.id }}" name="nombre" value="{{ grupo.nombre }}" required>

                <h3>Seleccionar Alumnos:</h3>
                <ul>
                    {% for alumno in alumnos %}
                        <li>
                            <input type="checkbox" name="alumnos" value="{{ alumno.id }}"
                                {% if alumno in grupo.alumnos.all %}checked{% endif %}>
                            {{ alumno.username }}
                        </li>
                    {% endfor %}
                </ul>

                <button type="submit">Guardar Cambios</button>
                <button type="button" onclick="cancelarEdicion({{ grupo.id }})">Cancelar</button>
            </form>
        </li>
    {% endfor %}
</ul>

<script>
    // Mostrar los campos de edición para un grupo específico
    function mostrarEdicion(grupoId) {
        const formEditar = document.getElementById(`form-editar-${grupoId}`);
        formEditar.style.display = 'block';

        const grupoNombre = document.querySelector(`#grupo-${grupoId} .grupo-nombre`);
        grupoNombre.style.display = 'none';
    }

    // Cancelar la edición y ocultar los campos
    function cancelarEdicion(grupoId) {
        const formEditar = document.getElementById(`form-editar-${grupoId}`);
        formEditar.style.display = 'none';

        const grupoNombre = document.querySelector(`#grupo-${grupoId} .grupo-nombre`);
        grupoNombre.style.display = 'inline';
    }
</script>
